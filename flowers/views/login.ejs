<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>登录</title>
    <link href="../bootstrap/css/bootstrap.css" rel="stylesheet">
    <style>
        body{
            background-image: url("../images/loginbg.jpg");
            background-size: cover;
            background-repeat: no-repeat;
        }
        .login{
            color: white;
            width: 100%;
            /*border: 1px solid red;*/
            margin-top: 25%;
            text-align: center;
        }
        .bg{
            background: white;
            color: #0f0f0f;
        }
        .logo{
            padding-top: 10%;
            width: 100%;
            /*text-align: center;*/
        }
        .logo span{
            font-size: 22px;
            vertical-align: middle;
        }
        .line,.line1{
            display: inline-block;
            width: 2px;
            height: 22px;
            background: white;
            margin: 0 15px ;
        }
        .line1{
            height: 15px;
            margin: 0 3px;
            background: #0f0f0f;
            width: 1px;
        }
        .content {
            padding-top: 10%;
            text-align: center;
            width: 100%;
            font-size: 18px;
            margin: 15px 0;
        }
        input{
            outline: none;
            font-size: 14px;
            width: 80%;
            height: 40px;
            line-height: 40px;
            margin: 10px 0;
            background: none;
            border: 1px solid grey;
            padding-left: 10px;
        }
        .loginpromit{
            width: 80%;
            margin: 0 auto;
            /*background: #360e10;*/
            /*border: 1px solid red;*/
            color: #ff166c;
            font-size: 10px;
            padding-left: 10px;
            height: 30px;
            text-align: left;
            padding-top: 3px;
            /*line-height: 30px;*/
            /*display: none;*/
        }
        #login{
            width: 80%;
            height: 40px;
            background: black;
            color: white;
            border: none;
            outline: none;
            font-size: 16px;
        }
        #login:hover{
            background-color: white;
            border: 1px solid #A9A7A8;
            color: black;
        }
        .last{
            padding-bottom: 10%;
        }
        a{
            display: block;
            width: 60%;
            margin: 0 auto;
            text-align: center;
            font-size: 14px;
            margin-top: 20px;
            padding-bottom: 5px;
            color: white;
            border-bottom: 1px solid white;
        }
        a:hover{
            color: #cbcbcb;
        }
        .lgpwd{
            height: 50px;
        }
        .pwd{
            width: 80%;
            margin: 10px auto;
            /*border: 1px solid red;*/
            text-align: left;
            padding-bottom: 13%;
        }
        .check{
            width: 14px;
            height: 14px;
            vertical-align: middle;
        }
        .pwd span{
            text-align: left;
            vertical-align: middle;
            font-size: 12px;
        }
        .forget button{
            background: none;
            border: none;
            outline: none;
            font-size: 12px;
        }
        .forget{
            float: right;
            vertical-align: middle;
        }
        .modal-step span{
            display: inline-block;
            width: 32%;
            margin-right: 2px;
            padding: 10px ;
            background: rgba(128, 128, 128, 0.25);
        }
        .modal-step1 span:first-child,.modal-step2 .sec,
        .modal-step3 span:last-child{
            background: #0DBD74;
            color: white;
        }
        .modal-tel,.modal-code{
            width: 80%;
            margin: 0 auto;
        }
        .modalspan{
            font-size: 16px;
            display: inline-block;
            width: 20%;
            text-align: right;
        }
        .modal-tel input,.modal-code input,#modalpwd1{
            width: 50%;
            height: 35px;
            border: 1px solid rgba(128, 128, 128, 0.46);
        }
        .modal-code input{
            width: 20%;
        }
        #get{
            width: 29%;
            height: 35px;
            background: none;
            outline: none;
            border: 1px solid rgba(128, 128, 128, 0.46)
        }
        .prompt{
            color: red;
            /*display: none;*/
        }
        .succ{
            text-align: center;
            width: 30%;
            margin: 20px auto;
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-sm-offset-1">
            <div class="login">
                <div class="logo">
                    <span>花庭阁</span>
                    <span class="line"></span>
                    <span>COURT PAVILION</span>
                </div>
                <div class="bg">
                    <div class="content">会员登录</div>
                    <hr>
                    <div><input type="text" id="tel" placeholder="输入您的手机号">
                    </div>
                    <div class="lgpwd"><input type="password" id="pwd" placeholder="输入您的密码">
                    </div>
                    <div class="loginpromit"></div>
                    <div><button id="login">登录</button></div>
                    <div class="pwd">
                        <input type="checkbox" class="check" checked><span>记住密码</span>
                        <div class="forget">
                            <button class="zhuce">注册</button>
                            <span class="line1"></span>
                            <button id="forget">忘记密码</button>
                        </div>
                    </div>
                </div>
                <div class="last"><a href="/">任性,不想登录>></a></div>
            </div>
            </div>
        </div>

    </div>
<!--模态框-->
<div class="modal fade" tabindex="-1" role="dialog" id="xiugai">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">通过手机重置密码</h4>
            </div>
            <div class="modal-body">
                <div class="modal-step modal-step1">
                    <span>1填写账号</span>
                    <span class="sec">2重置密码</span>
                    <span>3完成</span>
                </div>
                <div class="modal-tel">
                <span class="modalspan ">电话号码：</span><input type="text" id="modaltel">
                    <span class="prompt prompt1"></span>
            </div>
                <div class="modal-code">
                    <span class="modalspan ">验证码：</span><input type="text" id="code">
                    <button id="get">发送验证码</button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="next">下一步</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!--模态框下一步-->
<div class="modal fade" tabindex="-1" role="dialog" id="repeat">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">通过手机重置密码</h4>
            </div>
            <div class="modal-body">
                <div class="modal-step modal-step2">
                    <span>1填写账号</span>
                    <span class="sec">2重置密码</span>
                    <span>3完成</span>
                </div>
                <div class="modal-tel">
                    <span class="modalspan">新密码：</span><input type="password" id="modalpwd">
                    <span class="prompt prompt3"></span>
                </div>
                <div class="modal-code">
                    <span class="modalspan">确认密码：</span><input type="password" id="modalpwd1">
                    <span class="prompt prompt4"></span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="next1">下一步</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- 修改密码最后一步-->
<div class="modal fade" tabindex="-1" role="dialog" id="last">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">通过手机重置密码</h4>
            </div>
            <div class="modal-body">
                <div class="modal-step modal-step3">
                    <span>1填写账号</span>
                    <span class="sec">2重置密码</span>
                    <span>3完成</span>
                </div>
                <div class="succ"><span>修改成功!</span></div>
            </div>
            <div class="modal-footer">
                <!--<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>-->
                <button type="button" class="btn btn-primary" id="next2">确定</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<script src="../JavaScript/jquery-3.2.1.js"></script>
<script src="../bootstrap/js/bootstrap.js"></script>
<script>
    var prevLink = document.referrer;
    console.log(prevLink);
    /*if($.trim(prevLink)==''){  
        location.href = 'http://localhost:8888';  
    }else{  
        if(prevLink.indexOf('www.example.com')==-1){    //来自其它站点  
            location.href = 'www.example.com/index.html';  
        }  
        if(prevLink.indexOf('register.html')!=-1){      //来自注册页面  
            location.href = 'www.example.com/index.html';  
        }  
        location.href = prevLink;
    } */
    //注册跳转
    $(".zhuce").on("click",function () {
        location.href = "page/zhuce.html"
    })
    //登录事件
    $("#login").on("click",function () {
        let mytel=$("#tel").val()
        let mypwd=$("#pwd").val()
        if(mytel==""||mypwd==""){
            // $(".loginpromit").css("display","block")
            $(".loginpromit").html("!账号密码不能为空")
        }
        else {
            myCheckPhone()
        }
        // //设置用户名保存
        // localStorage.setItem('user',mytel);
        // //设置密码保存
        // if ($('.check').is(":checked")) {
        //     localStorage.setItem('pwd',mypwd);
        // }else{
        //     localStorage.setItem('pwd','');
        // }
    });
    //页面加载时，获取保存的用户名和密码
    // $(function () {
    //     console.log(localStorage.getItem('user'));
    //     let mytel=$("#tel").val(localStorage.getItem("user"));
    //     let mypwd=$("#pwd").val(localStorage.getItem("pwd"));
    // });
    

    //登录
    function myCheckPhone(){
        let mytel=$("#tel").val()
        let mypwd=$("#pwd").val()
        if(!(/^1[34578]\d{9}$/.test(mytel))){
            // $(".loginpromit").css("display","block")
            $(".loginpromit").html("!账号格式不正确")
            return false;
        }
        else {
            $.ajax({
                data:{tel:mytel,pwd:mypwd},
                url:"/login.do",
                type:"post",
                success:function (data) {
                    console.log(data)
                    if(data=="1"){
                        //location.href="../";
                        console.log(prevLink);
                        if($.trim(prevLink)==''){  
                            location.href = 'http://localhost:8888';  
                        }else{  
                            if(prevLink.indexOf('www.example.com')==-1){    //来自其它站点  
                                location.href = 'www.example.com/index.html';  
                            }  
                            if(prevLink.indexOf('register.html')!=-1){      //来自注册页面  
                                location.href = 'www.example.com/index.html';  
                            }  
                            location.href = prevLink;
                        } 
                    }
                    else{
                        // $(".loginpromit").css("display","block")
                        $(".loginpromit").html("!账号或密码不正确")
                    }
                }
            })
            // console.log(1111)
        }
    }

    //获取焦点
    $("#tel").focus(function () {
        $(".loginpromit").html("");
    });
    $("#pwd").focus(function () {
        $(".loginpromit").html("");
    });


    //忘记密码事件
    $("#forget").on("click",function () {
        // console.log(11)
        $("#xiugai").modal("show");
        //模态框初始化
        $(".prompt1").html("");
        $("#modaltel").val("")
        $("#code").css("border","1px solid rgba(128, 128, 128, 0.46)")
        $("#modaltel").css("border","1px solid rgba(128, 128, 128, 0.46)")
        $("#code").val("")
    })

    //忘记密码模态框
    //失去焦点判断
    $("#modaltel").blur(function () {
        let mytel=$("#modaltel").val()
        if(mytel==""){
            $("#modaltel").css("border","1px solid #ff5a4d")
            $(".prompt1").html("！不能为空")
        }
        else {
            checkPhone()
        }
    })
    // 密码
    $("#modalpwd").blur(function(){
        let pwd=$("#modalpwd").val()
        if(pwd==""){
            $("#modalpwd").css("border","1px solid #ff5a4d")
            $(".prompt3").html("密码不能为空")
        }
        // else {
        //     checkpwd()
        // }
    })
    //确认密码判断
    $("#modalpwd1").blur(function () {
        let pwd=$("#modalpwd").val()
        let pwd1=$("#modalpwd1").val()
        if(pwd1==""){
            $(".prompt4").html("密码不能为空")
            $("#modalpwd1").css("border","1px solid #ff5a4d")
        }
        else if(pwd==pwd1){
            $(".prompt4").html("")
            $("#modalpwd1").css("border","1px solid rgba(128, 128, 128, 0.46)")
        }
        else{
            $(".prompt4").html("密码不一致")
            $("#modalpwd1").css("border","1px solid #ff5a4d")
        }
    })
    //密码事件
    $("#modalpwd").keyup(function () {
        let pwd=$("#modalpwd").val()
        if(pwd.length<6){
            $(".prompt3").html("！必须大于6位")
            $("#modalpwd").css("border","1px solid #ff5a4d")
        }
        else if(pwd.length<16){
            $("#modalpwd").css("border","1px solid rgba(128, 128, 128, 0.46)")
            $(".prompt3").html("")
        }
        else {
            $(".prompt3").html("!密码太长")
            $("#modalpwd").css("border","1px solid #ff5a4d")
        }
    })
    //验证码
    $("#code").blur(function () {
        let mycode=$("#code").val()
        if(mycode==""){
            $("#code").css("border","1px solid #ff5a4d")
        }
        else{
            $("#code").css("border","1px solid rgba(128, 128, 128, 0.46)")
        }
    })

    //手机号验证
    function checkPhone(){
        let mytel=$("#modaltel").val()
        if(!(/^1[34578]\d{9}$/.test(mytel))){
            $(".prompt1").html("输入正确手机号")
            $("#modaltel").css("border","1px solid #ff5a4d")
            return false;
        }
        else {
            $.ajax({
                data:{tel:mytel},
                url:"/checktel.do",
                type:"post",
                success:function (data) {
                    // console.log(data)
                    if(data==0){
                        $(".prompt1").html("账号不存在")
                        $(".prompt1").css("color","#ff5a4d")
                        $("#modaltel").css("border","1px solid #ff5a4d")
                    }
                    else{
                        $(".prompt1").html("")
                        $("#modaltel").css("border","1px solid rgba(128, 128, 128, 0.46)")
                    }
                }
            })
            // console.log(1111)
        }
    }
    //密码正则验证
    // function checkpwd() {
    //     let pwd=$("#pwd").val()
    //     let regExp=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,16}$/
    //     if(!(regExp.test(pwd))){
    //         // $(".prompt2").html("!密码长度必须在6-16个字符之间")
    //         return false;
    //     }
    // }
    //获取验证码
    $("#get").on("click",function(){
        let mytel=$("#modaltel").val()
        if(mytel==""){
            $("#modaltel").css("border","1px solid #ff5a4d")
            $(".prompt1").html("！不能为空")
        }
        else if($(".prompt1").html()==""){
            // console.log(555)
            $.ajax({
                data:{tel:mytel},
                url:"/get.do",
                type:"post",
                success:function (data) {
                    console.log(data)
                    if(data=='0'){
                        // alert("输入正确手机号")
                    }
                    else if(data=='1') {
                        // alert("验证码已发送")
                        sendetel()
                    }
                }
            })
        }
    })
    //发送验证码倒计时
    var countdown = 60;
    function sendetel() {
        var obj = $("#get");
        settime(obj);
    }
    function settime(obj) { //发送验证码倒计时
        if (countdown == 0) {
            obj.attr('disabled', false);
            //obj.removeattr("disabled");
            obj.html("获取验证码");
            countdown = 60;
            return;
        } else {
            obj.attr('disabled', true);
            obj.html("重新发送(" + countdown + ")s");
            countdown--;
        }
        setTimeout(function() {
            settime(obj)
        }, 1000)
    }

    //忘记密码下一步
    $("#next").on("click",function () {
        let mycode=$("#code").val()
        let mytel=$("#modaltel").val()
        if(mytel==""){
            $("#modaltel").css("border","1px solid #ff5a4d")
        }
        if(mycode==""){
            $("#code").css("border","1px solid #ff5a4d")
        }
        if(mytel!=""&&mycode!=""){
            $.ajax({
                data:{tel:mytel,code:mycode},
                url:"/code.do",
                type:"post",
                success:function (data) {
                    // console.log(data)
                    if(data==1){
                        // console.log(111)
                        $("#xiugai").modal("hide")
                        $("#repeat").modal("show")
                    }
                }
            })
        }
    })

    //修改密码下一步
    $("#next1").on("click",function () {
        let mytel=$("#modaltel").val()
        let mypwd=$("#modalpwd").val()
        let mypwd1=$("#modalpwd1").val()
        if(mypwd==""){
            $("#modalpwd").css("border","1px solid #ff5a4d")
        }
        if(mypwd1==""){
            $("#modalpwd1").css("border","1px solid #ff5a4d")
        }
        if(mypwd!=""&&mypwd==mypwd1){
            $.ajax({
                data:{tel:mytel,pwd:mypwd},
                url:"/pwdxiugai.do",
                type:"post",
                success:function (data) {
                    console.log(data)
                    if(data=='1'){
                        $("#repeat").modal("hide")
                        $("#last").modal("show")
                    }
                }
            })
        }
    })
    $("#next2").on("click",function () {
        $("#last").modal("hide")
    })

</script>
</body>
</html>